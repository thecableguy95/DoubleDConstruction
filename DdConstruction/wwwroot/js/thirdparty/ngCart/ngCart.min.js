"use strict";angular.module("ngCart",["ngCart.directives"]).config([function(){}]).provider("$ngCart",function(){this.$get=function(){}}).run(["$rootScope","ngCart","ngCartItem","store",function(n,t,i,r){n.$on("ngCart:change",function(){t.$save()});angular.isObject(r.get("cart"))?t.$restore(r.get("cart")):t.init()}]).service("ngCart",["$rootScope","ngCartItem","store",function(n,t,i){this.init=function(){this.$cart={shipping:null,taxRate:null,tax:null,items:[]}};this.addItem=function(i,r,u,f,e){var o=this.getItemById(i),s;typeof o=="object"?(o.setQuantity(f,!1),n.$broadcast("ngCart:itemUpdated",o)):(s=new t(i,r,u,f,e),this.$cart.items.push(s),n.$broadcast("ngCart:itemAdded",s));n.$broadcast("ngCart:change",{})};this.getItemById=function(n){var i=this.getCart().items,t=!1;return angular.forEach(i,function(i){i.getId()===n&&(t=i)}),t};this.setShipping=function(n){return this.$cart.shipping=n,this.getShipping()};this.getShipping=function(){return this.getCart().items.length===0?0:this.getCart().shipping};this.setTaxRate=function(n){return this.$cart.taxRate=+parseFloat(n).toFixed(2),this.getTaxRate()};this.getTaxRate=function(){return this.$cart.taxRate};this.getTax=function(){return+parseFloat(this.getSubTotal()/100*this.getCart().taxRate).toFixed(2)};this.setCart=function(n){return this.$cart=n,this.getCart()};this.getCart=function(){return this.$cart};this.getItems=function(){return this.getCart().items};this.getTotalItems=function(){var n=0,t=this.getItems();return angular.forEach(t,function(t){n+=t.getQuantity()}),n};this.getTotalUniqueItems=function(){return this.getCart().items.length};this.getSubTotal=function(){var n=0;return angular.forEach(this.getCart().items,function(t){n+=t.getTotal()}),+parseFloat(n).toFixed(2)};this.totalCost=function(){return+parseFloat(this.getSubTotal()+this.getShipping()+this.getTax()).toFixed(2)};this.removeItem=function(t){var i=this.$cart.items.splice(t,1)[0]||{};n.$broadcast("ngCart:itemRemoved",i);n.$broadcast("ngCart:change",{})};this.removeItemById=function(t){var r,i=this.getCart();angular.forEach(i.items,function(n,r){n.getId()===t&&(n=i.items.splice(r,1)[0]||{})});this.setCart(i);n.$broadcast("ngCart:itemRemoved",r);n.$broadcast("ngCart:change",{})};this.empty=function(){n.$broadcast("ngCart:change",{});this.$cart.items=[];localStorage.removeItem("cart")};this.isEmpty=function(){return this.$cart.items.length>0?!1:!0};this.toObject=function(){if(this.getItems().length===0)return!1;var n=[];return angular.forEach(this.getItems(),function(t){n.push(t.toObject())}),{shipping:this.getShipping(),tax:this.getTax(),taxRate:this.getTaxRate(),subTotal:this.getSubTotal(),totalCost:this.totalCost(),items:n}};this.$restore=function(n){var i=this;i.init();i.$cart.shipping=n.shipping;i.$cart.tax=n.tax;angular.forEach(n.items,function(n){i.$cart.items.push(new t(n._id,n._name,n._price,n._quantity,n._data))});this.$save()};this.$save=function(){return i.set("cart",JSON.stringify(this.getCart()))}}]).factory("ngCartItem",["$rootScope","$log",function(n,t){var i=function(n,t,i,r,u){this.setId(n);this.setName(t);this.setPrice(i);this.setQuantity(r);this.setData(u)};return i.prototype.setId=function(n){n?this._id=n:t.error("An ID must be provided")},i.prototype.getId=function(){return this._id},i.prototype.setName=function(n){n?this._name=n:t.error("A name must be provided")},i.prototype.getName=function(){return this._name},i.prototype.setPrice=function(n){var i=parseFloat(n);i?i<=0?t.error("A price must be over 0"):this._price=i:t.error("A price must be provided")},i.prototype.getPrice=function(){return this._price},i.prototype.setQuantity=function(n,i){var r=parseInt(n);r%1==0?(i===!0?this._quantity+=r:this._quantity=r,this._quantity<1&&(this._quantity=1)):(this._quantity=1,t.info("Quantity must be an integer and was defaulted to 1"))},i.prototype.getQuantity=function(){return this._quantity},i.prototype.setData=function(n){n&&(this._data=n)},i.prototype.getData=function(){if(this._data)return this._data;t.info("This item has no data")},i.prototype.getTotal=function(){return+parseFloat(this.getQuantity()*this.getPrice()).toFixed(2)},i.prototype.toObject=function(){return{id:this.getId(),name:this.getName(),price:this.getPrice(),quantity:this.getQuantity(),data:this.getData(),total:this.getTotal()}},i}]).service("store",["$window",function(n){return{get:function(t){if(n.localStorage[t]){var i=angular.fromJson(n.localStorage[t]);return JSON.parse(i)}return!1},set:function(t,i){return i===undefined?n.localStorage.removeItem(t):n.localStorage[t]=angular.toJson(i),n.localStorage[t]}}}]).controller("CartController",["$scope","ngCart",function(n,t){n.ngCart=t}]).value("version","1.0.0");angular.module("ngCart.directives",["ngCart.fulfilment"]).controller("CartController",["$scope","ngCart",function(n,t){n.ngCart=t}]).directive("ngcartAddtocart",["ngCart",function(n){return{restrict:"E",controller:"CartController",scope:{id:"@",name:"@",quantity:"@",quantityMax:"@",price:"@",data:"="},transclude:!0,templateUrl:function(n,t){return typeof t.templateUrl=="undefined"?"template/ngCart/addtocart.html":t.templateUrl},link:function(t,i,r){t.attrs=r;t.inCart=function(){return n.getItemById(r.id)};t.q=t.inCart()?n.getItemById(r.id).getQuantity():parseInt(t.quantity);t.qtyOpt=[];for(var u=1;u<=t.quantityMax;u++)t.qtyOpt.push(u)}}}]).directive("ngcartCart",[function(){return{restrict:"E",controller:"CartController",scope:{},templateUrl:function(n,t){return typeof t.templateUrl=="undefined"?"template/ngCart/cart.html":t.templateUrl},link:function(){}}}]).directive("ngcartSummary",[function(){return{restrict:"E",controller:"CartController",scope:{},transclude:!0,templateUrl:function(n,t){return typeof t.templateUrl=="undefined"?"template/ngCart/summary.html":t.templateUrl}}}]).directive("ngcartCheckout",[function(){return{restrict:"E",controller:["$rootScope","$scope","ngCart","fulfilmentProvider",function(n,t,i,r){t.ngCart=i;t.checkout=function(){r.setService(t.service);r.setSettings(t.settings);r.checkout().then(function(t){n.$broadcast("ngCart:checkout_succeeded",t);window.location.href="/"},function(t,i){n.$broadcast("ngCart:checkout_failed",{statusCode:i,error:t})})}}],scope:{service:"@",settings:"="},transclude:!0,templateUrl:function(n,t){return typeof t.templateUrl=="undefined"?"template/ngCart/checkout.html":t.templateUrl}}}]);angular.module("ngCart.fulfilment",[]).service("fulfilmentProvider",["$injector",function(n){this._obj={service:undefined,settings:undefined};this.setService=function(n){this._obj.service=n};this.setSettings=function(n){this._obj.settings=n};this.checkout=function(){var t=n.get("ngCart.fulfilment."+this._obj.service);return t.checkout(this._obj.settings)}}]).service("ngCart.fulfilment.log",["$q","$log","ngCart",function(n,t,i){this.checkout=function(){var r=n.defer();return t.info(i.toObject()),r.resolve({cart:i.toObject()}),r.promise}}]).service("ngCart.fulfilment.http",["$http","ngCart",function(n,t){this.checkout=function(i){return n.post(i.url,{data:t.toObject(),options:i.options})}}]).service("ngCart.fulfilment.paypal",["$http","ngCart",function(){}]);